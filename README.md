# MCPollinations Multimodal MCP Server

A Model Context Protocol (MCP) server that enables AI assistants to generate images, text, and audio through the Pollinations APIs

## Features

- Generate image URLs from text prompts
- Generate images and return them as base64-encoded data AND save as png, jpeg, jpg, or webp (default: png)
- Generate text responses from text prompts
- Generate audio responses from text prompts
- List available image and text generation models
- No authentication required
- Simple and lightweight
- Compatible with the Model Context Protocol (MCP)

## System Requirements

- **Node.js**: Version 14.0.0 or higher
  - For best performance, we recommend Node.js 16.0.0 or higher
  - Node.js versions below 16 use an AbortController polyfill

## Quick Start

The easiest way to use the MCP server:

```bash
# Run directly with npx (no installation required)
npx @pinkpixel/mcpollinations
```

If you prefer to install it globally:

```bash
# Install globally
npm install -g @pinkpixel/mcpollinations

# Run the server
mcpollinations
# or
npx @pinkpixel/mcpollinations

```

Or clone the repository:

```bash
# Clone the git repository
git clone https://github.com/pinkpixel-dev/mcpollinations.git
# Run the server
mcpollinations
# or
npx @pinkpixel/mcpollinations
# or run directly
node /path/to/MCPollinations/pollinations-mcp-server.js

```

## MCP Integration

To integrate the server with applications that support the Model Context Protocol (MCP):

1. Generate an MCP configuration file:

```bash
# If installed globally
npx @pinkpixel/mcpollinations generate-config

# Or run directly
node /path/to/MCPollinations/generate-mcp-config.js
```

2. Follow the prompts to customize your configuration or use the defaults.
   - Set custom output and temporary directories (defaults to relative paths for portability)
   - Configure default parameters for image generation (with a list of available models, dimensions, etc.)
   - Configure default parameters for text generation (with a list of available models)
   - Configure default parameters for audio generation (voice)
   - Specify which tools should be allowed

3. Copy the generated `mcp.json` file to your application's MCP settings .json file.
4. Restart your application.

After integration, you can use commands like:

"Generate an image of a sunset over the ocean using MCPollinations"


## Troubleshooting

### "AbortController is not defined" Error

If you encounter this error when running the MCP server:

```
ReferenceError: AbortController is not defined
```

This is usually caused by running on an older version of Node.js (below version 16.0.0). Try one of these solutions:

1. **Update Node.js** (recommended):
   - Update to Node.js 16.0.0 or newer

2. **Use Global Installation**
   - Update to the latest version of the package:
   ```bash
   npm install -g @pinkpixel/mcpollinations
   # Run with npx
   npx @pinkpixel/mcpollinations
   ```

3. **Install AbortController manually**:
   - If for some reason the polyfill doesn't work:
   ```bash
   npm install node-abort-controller
   ```

### Check Your Node.js Version

To check your current Node.js version:

```bash
node --version
```

If it shows a version lower than 16.0.0, consider upgrading for best compatibility.

## Available Tools

The MCP server provides the following tools:

1. `generateImageUrl` - Generates an image URL from a text prompt
2. `generateImage` - Generates an image, returns it as base64-encoded data, and saves it to a file by default (PNG format)
3. `respondAudio` - Generates an audio response to a text prompt (customizable voice parameter)
4. `respondText` - Responds with text to a prompt using text models (customizable model parameter)
5. `listImageModels` - Lists available models for image generation
6. `listTextModels` - Lists available models for text generation
7. `listAudioVoices` - Lists all available voices for audio generation

## Image Generation Details

### Default Behavior

When using the `generateImage` tool:

- Images are saved to disk by default as PNG files
- The default save location is the current working directory where the MCP server is running
- The 'flux' model is used by default
- A random seed is generated by default for each image (ensuring variety)
- Base64-encoded image data is always returned, regardless of whether the image is saved to a file

### Customizing Image Generation

```javascript
// Example options for generateImage
const options = {
  // Model selection (defaults to 'flux')
  model: "flux",

  // Image dimensions
  width: 1024,
  height: 1024,

  // Generation options
  seed: 12345,  // Specific seed for reproducibility (defaults to random)
  enhance: true,  // Enhance the prompt using an LLM before generating (defaults to true)
  safe: false,  // Content filtering (defaults to false)

  // File saving options
  saveToFile: true,  // Set to false to skip saving to disk
  outputPath: "/path/to/save/directory",  // Custom save location
  fileName: "my_custom_name",  // Without extension
  format: "png"  // png, jpeg, jpg, or webp
};
```

### Where Images Are Saved

When using Claude or another application with the MCP server:

1. **Images are saved in the current working directory of where the MCP server is running**, not where Claude or the client application is installed.

2. If you start the MCP server manually from a specific directory, images will be saved there by default.

3. If Claude Desktop launches the MCP server automatically, images will be saved in Claude Desktop's working directory (typically in an application data folder).

### Finding Your Generated Images

- The response from Claude after generating an image includes the full file path where the image was saved
- You can specify a familiar location using the `outputPath` parameter
- Best practice: Ask Claude to save images to an easily accessible folder like your Pictures or Downloads directory

### Unique Filenames

The MCP server ensures that generated images always have unique filenames and will never overwrite existing files:

1. **Default filenames** include:
   - A sanitized version of the prompt (first 20 characters)
   - A timestamp
   - A random suffix

2. **Custom filenames** are also protected:
   - If you specify a filename and a file with that name already exists, a numeric suffix will be added automatically
   - For example: `sunset.png`, `sunset_1.png`, `sunset_2.png`, etc.

This means you can safely generate multiple images with the same prompt or filename without worrying about overwriting previous images.

### Accessing Base64 Data

Even when saving to a file, the base64-encoded image data is always returned and can be used for:

- Embedding in web pages (`<img src="data:image/png;base64,..." />`)
- Passing to other services or APIs
- Processing in memory without filesystem operations
- Displaying in applications that support data URIs

## For Developers

If you want to use the package in your own projects:

```bash
# Install as a dependency
npm install @pinkpixel/mcpollinations

# Import in your code
import { generateImageUrl, generateImage, repsondText, respondAudio, listTextModels, listImageModels, listAudioVoices } from '@pinkpixel/mcpollinations';
```
